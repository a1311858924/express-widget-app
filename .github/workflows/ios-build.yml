# 🔧 修复 Setup Flutter 失败问题

## 🎯 问题诊断
"Setup Flutter" 步骤失败通常是由于：
- Flutter版本指定问题
- 网络连接问题
- GitHub Actions环境问题

## 🚀 立即修复方案

### 方案1：使用最新稳定版Flutter
**修改工作流文件**，使用更稳定的配置：

```yaml
name: Build iOS IPA

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: 'stable'
        
    - name: Verify Flutter installation
      run: flutter --version
      
    - name: Install dependencies
      run: flutter pub get
      
    - name: Build iOS (no codesign)
      run: flutter build ios --release --no-codesign
      
    - name: Create unsigned IPA
      run: |
        cd build/ios/iphoneos
        mkdir -p Payload
        cp -r Runner.app Payload/
        zip -r ExpressWidget-unsigned.ipa Payload/
        
    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: ios-ipa-unsigned
        path: build/ios/iphoneos/ExpressWidget-unsigned.ipa
```

### 方案2：使用官方Flutter Action
**更换为官方推荐的Flutter Action**：

```yaml
name: Build iOS IPA

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Flutter SDK
      uses: flutter-actions/setup-flutter@v3
      with:
        channel: stable
        version: latest
        
    - name: Install dependencies
      run: flutter pub get
      
    - name: Build iOS (no codesign)
      run: flutter build ios --release --no-codesign
      
    - name: Create unsigned IPA
      run: |
        cd build/ios/iphoneos
        mkdir -p Payload
        cp -r Runner.app Payload/
        zip -r ExpressWidget-unsigned.ipa Payload/
        
    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: ios-ipa-unsigned
        path: build/ios/iphoneos/ExpressWidget-unsigned.ipa
```

### 方案3：最简化版本（推荐）
**去掉版本指定，让GitHub自动选择**：

```yaml
name: Build iOS IPA

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      
    - name: Install dependencies
      run: flutter pub get
      
    - name: Build iOS (no codesign)
      run: flutter build ios --release --no-codesign
      
    - name: Create unsigned IPA
      run: |
        cd build/ios/iphoneos
        mkdir -p Payload
        cp -r Runner.app Payload/
        zip -r ExpressWidget-unsigned.ipa Payload/
        
    - name: Upload IPA artifact
      uses: actions/upload-artifact@v4
      with:
        name: ios-ipa-unsigned
        path: build/ios/iphoneos/ExpressWidget-unsigned.ipa
```

## 🎯 立即执行修复

### 步骤1：更新工作流文件
1. 在仓库中打开 `.github/workflows/ios-build.yml`
2. 点击编辑按钮
3. 替换为上面的"方案3"内容
4. 提交更改

### 步骤2：手动触发构建
1. 进入Actions页面
2. 选择"Build iOS IPA"工作流
3. 点击"Run workflow"

## 🔍 如果仍然失败

**查看具体错误信息**：
1. 点击失败的"Setup Flutter"步骤
2. 查看详细日志
3. 告诉我具体的错误信息

**常见错误和解决方案**：
- 网络超时：重新运行构建
- 版本不兼容：使用最新稳定版
- 权限问题：检查仓库设置
